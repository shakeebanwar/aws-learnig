Amazone Credential:
u882515@gmail.com

Shaigan Ip:
51.79.51.181

How to Enable Password Authentication in AWS ec2 Instances:

Step 1:
ssh -i "hnh.pem" ubuntu@ec2-3-139-68-29.us-east-2.compute.amazonaws.com

Step 2:
sudo passwd ubuntu(ubuntu is my username)

Step 3:
sudo vim /etc/ssh/sshd_config

*Find the Line containing 'PasswordAuthentication' parameter and change its value from 'no' to 'yes'

*PasswordAuthentication yes

*If you want to set up 'root' login, find  'PermitRootLogin' parameter and change its value from 'prohibit-password' to 'yes'

*PermitRootLogin yes


Step 4:
service ssh restart

Step 5:
ssh ubuntu@ec2-3-139-68-29.us-east-2.compute.amazonaws.com


Root User:
ssh ubuntu@3.143.108.49

Normal User:
ssh shakeeb@3.143.108.49


Git Installation:
sudo apt install git-all

Docker Installation:

1.sudo apt-get update
2.sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common

3.curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
4.sudo apt-get install docker-ce docker-ce-cli containerd.io
5.apt-cache madison docker-ce
6.sudo apt-get install docker-ce docker-ce-cli containerd.io
7.sudo apt install docker.io
8.sudo apt install docker-compose



After deploying the docker container Ec2 Instance:
Allow the port to edit the security group for Example if your docker container run 8005 so edit edit the security group tcp 8005 


Bind a Domain:


sudo vim /etc/nginx/sites-available/clearpricing.ga
sudo ln -s /etc/nginx/sites-available/clearpricing.ga /etc/nginx/sites-enabled
sudo systemctl restart nginx



Create a Reverse Proxy using Ngnix:

server {
    listen 80;
    server_name www.clearpricing.ga;

    location / {

        proxy_pass http://18.119.12.94:8005;
    }
}

Create a Reverse Proxy using Apache:                                                                    
                                                                                              
<VirtualHost *:80>
 ServerName shaigansehat.com
 ServerAlias www.shaigansehat.com
 ProxyPass / http://51.79.51.181:8000/
</VirtualHost>



Transfer local machine file to remote server:
scp -r ./build/* username@server_ip:/var/www/your_domain/html


How i host react using nginix
----------------------------------
1.first upload your build folder.
2.create a reverse proxy using nginx

vim /etc/nginx/sites-enabled/your_domain
server {
        listen 80;
        listen [::]:80;

        root /hnh/deploy/build;
        index index.html index.htm index.nginx-debian.html;

        server_name clearpricing.ml www.clearpricing.ml;

        location / {
                try_files $uri $uri/ =404;
        }
}


####add htc access 


server {
        listen 80;
        listen [::]:80;
        root /hnh/testing/testbuild/build;
        index index.html index.htm index.nginx-debian.html;

        server_name cynotech.ga www.cynotech.ga;

        location ~* \.(?:manifest|appcache|html?|xml|json)$ {
    expires -1;
    # access_log logs/static.log; # I don't usually include a static log
  }

  location ~* \.(?:css|js)$ {
    try_files $uri =404;
    expires 1y;
    access_log off;
    add_header Cache-Control "public";
  }

  # Any route containing a file extension (e.g. /devicesfile.js)
  location ~ ^.+\..+$ {
    try_files $uri =404;
  }

  # Any route that doesn't have a file extension (e.g. /devices)
  location / {
    try_files $uri $uri/ /index.html;
  }
}


3.systemctl restart nginx
-------------------------------------------

How i ssl your domain:
-------------------------------------------
1.sudo apt install certbot python3-certbot-nginx
2.create a proxy file verify the syntax of your configuration:
    * sudo nginx -t
    
3.Reload Nginx to load the new configuration:
    * sudo systemctl reload nginx
    
4.To additionally let in HTTPS traffic, allow the Nginx Full profile and delete the redundant Nginx HTTP profile allowance:
    *sudo ufw allow 'Nginx Full'
    *sudo ufw delete allow 'Nginx HTTP'
    *sudo ufw status
    
    
5.Obtaining an SSL Certificate:
 *sudo certbot --nginx -d example.com -d www.example.com
 
6.Verifying Certbot Auto-Renewal:
    *sudo systemctl status certbot.timer
    *To test the renewal process, you can do a dry run with certbot:
        *sudo certbot renew --dry-run
-------------------------------------------


How i Excess gunicorn server inside the docker using nginx:
1.sudo vim /etc/nginx/sites-available/ngnixguni
2.  server {
    listen 80;
    server_name techbullet.ga www.techbullet.ga;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /hnh/ngnixtest/testing-nginx;
    }

    location /upload/ {
      root /hnh/ngnixtest/testing-nginx;
    }

    location / {
      proxy_pass http://3.143.108.49:8004;
    }
}


3.sudo ln -s /etc/nginx/sites-available/ngnixguni /etc/nginx/sites-enabled/
4.ssl(sudo certbot --nginx -d techbullet.ga -d www.techbullet.ga)
5.systemctl restart nginx






##########################If your root or other user password is not update so try this##################################

chattr -i /etc/gshadow
chattr -i /etc/group
chattr -ai /etc/shadow
chattr -ai /etc/passwd



##################################################Django channels##############################################################
Requirements:

Django==3.2.6
channels
channels_redis
Twisted[tls,http2]

Deployement:
we need a Asynchronous web server for deployment like daphne

docker-compose file:

version: "3.7"
services:
  
  redis:
    restart: always
    image: redis:latest
    ports:
      - "6379:6379"
    volumes:
      - ./redisdata:/data
        proxy_redirect off;
        proxy_pass http://18.119.140.171:8005;
    }
    
    
*reload the ngnix server
*your ssl private key and certification file is present at this location  /etc/letsencrypt/live




#############How i increase the file uploading size in nginx#########################


sudo nano /etc/nginx/nginx.conf
http {
    # [...]
    client_max_body_size 100m;  //add only this line 
    # [...]
}

sudo systemctl restart nginx



######################how to install mysql client ubuntu###########################


1.sudo apt install python3-dev build-essential
2.sudo apt install libssl1.1
3.sudo apt install libssl1.1=1.1.1f-1ubuntu2
4.sudo apt install libssl-dev
5.sudo apt install libmysqlclient-dev
6.pip3 install mysqlclient


####How i use mysql outside the docker container####


docker run -p 3307:3306 --name my-mysql -e MYSQL_ROOT_PASSWORD=root -d mysql/mysql-server:latest
docker exec -it containerid bash
mysql -u root -p
enter the password root
select user,host from mysql.user;
update mysql.user set host='%' where user='root';
flush privileges;
create database clearcost;

*configure phpmyadmin and connect to mysql
    docker run --name dev-phpmyadmin -d --link my-mysql:db -p 7098:80 phpmyadmin/phpmyadmin
      
     DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'clearcost',
        'USER': 'root',
        'PASSWORD': 'root',
        'HOST': '192.168.0.178',
        'PORT': 3307,
        
    }
}



#####################################          Move folder/file from local machine to docker container   ###########################################


docker cp foo.txt container_id:/foo.txt


####################For the created containers use docker update to update restart policy.#######################
docker update --restart=always 0576df221c0b


###Restart container using docker-compose file###################
version: "3.7"
services:
  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/code
    ports:
      - "8005:8000"
    restart: always





###Restart the all the docker container#########
docker restart $(docker ps -q)


########Remove all the none tag images#############
docker rmi $(docker images --filter "dangling=true" -q --no-trunc)


#### Map the current folder outside the container#######################

version: "3.7"
services:
  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:  
      - .:/code
    ports:
      - "8005:8000"
      
      
*The volumes tag is a simple saying: "Hey, map the current folder outside the container (the dot) to the working directory inside the container".



#############################Use Postgre outside the docker########################################################


version: '3.7'
services:
    postgres:
        image: postgres
        restart: always
        expose:
          - "5432"
        ports:
          - 5432:5432
        environment:
          - POSTGRES_DB=postgres
          - POSTGRES_USER=postgres
          - POSTGRES_PASSWORD=postgres
          - POSTGRES_HOST=127.0.0.1
        


#######################################################################



#######################################Auto deployment github##############


mkdir backrepo && cd backrepo
mkdir site.git && cd site.git
git init --bare
cd hooks
vim post-receive
git --work-tree=/hnh/backend/email-sender --git-dir=/hnh/backrepo/site.git checkout -f
chmod +x post-receive
git remote add live root@139.99.238.238/hnh/backrepo/site.git



###########################################################################
Nginx Load balancing using round robin


upstream endpoint1 {
 server 18.119.140.171:8005;
 server 18.119.140.171:8006;



}
server {
    listen 80;
    server_name beta.jawadsheikh.ml;

    location / {

        proxy_pass http://endpoint1;
    }
}


Nginx Load balancing using wighted approach

upstream endpoint1 {
 server 18.119.140.171:8005;  ##means weight=1
 server 18.119.140.171:8006 weight=2; #means ya server zada powerful ha ya zada request handle karaga weight=2 means 2 bar is per request aye phr 1 bar weight=1 wala pa jaye gi:wq
 



}
server {
    listen 80;
    server_name beta.jawadsheikh.ml;

    location / {

        proxy_pass http://endpoint1;
    }
}


Nginx Load balancing using least connection

upstream endpoint1 {
  least_conn;
  server 18.119.140.171:8005; 
  server 18.119.140.171:8006; 



}
server {
    listen 80;
    server_name beta.jawadsheikh.ml;

    location / {

        proxy_pass http://endpoint1;
    }
}



###########################################################################
How i Increase ssh timeout

ssh -o ServerAliveInterval=300 root@shakeeb.ml

#############################################################################





###Docker swarm installation #############################################



Docker Swarm:


Create a virtual machine:
 docker-machine create --driver virtualbox machine-name

Check no of macine:
 docker-machine ls

Enter into specific machine:
 docker-machine ssh machine-name



 Create a manager:

 1.Enter in to the machine using docker-machine ssh machine-name
 2.docker swarm init --advertise-addr ip-address


JOIN A WORKER:
when create a manager docker swarm produce a token this token is used to join a manager
for example my join command is 

docker swarm join --token SWMTKN-1-4wdsjzm0myc14jqiwptcpog4wfgzht1wyq8p490063mv00xan4-0puuyjguf2qwsvllv0mppuc4r 192.168.99.101:2377


check no of nodes:
 docker node ls
 * this command is only run in manager node


Manage Join Token:
docker swarm join-token manager //if worker so this token is only used for join a worker

The output of this command is
    docker swarm join --token SWMTKN-1-4wdsjzm0myc14jqiwptcpog4wfgzht1wyq8p490063mv00xan4-5ecmnybvz9f13jkldxh1ej3o2 192.168.99.101:2377




Inspect a node:
   Display a detailed information about nodes

   docker node inspect manager1


Promote a node:
    docker node promote worker

Demote a node
    docker node demote worker

information about Docker
    docker info


Types of services in docker swarm:
1.Replicated.
2.Global.

In dono ma jo major difference ha wo ya ha ka Global services all nodes 
pa run karti ha jb ka Replicated Sirf jitna nodes hum define karga sirf 
uspa hi run karagi.

Create a Replicated services:
    docker service create --replicas 4 --name web1 nginx

    *docker service ls (list of services)
    *docker service ps web1 (web1 is a service name)


Scale up your service:
    docker service scale web1=7

Stop service:
    docker service scale web1=0

Update service with a specific version:
    docker service update web1:version
    
    

Deploy a container using docker swarm

1.docker-compose build --no-cache
2.docker stack deploy -c docker-compose.yml pandaswarm
3.docker service update --force pandaswarm_web (when something change in your application)
 
 

##########################################################################

Install Docker in Aws Ami:

sudo yum update -y
sudo amazon-linux-extras install docker
sudo yum install docker
sudo service docker start
sudo usermod -a -G docker ec2-user
sudo curl -L https://github.com/docker/compose/releases/download/1.21.0/docker-compose-`uname -s`-`uname -m` | sudo tee /usr/local/bin/docker-compose > /dev/null
sudo chmod +x /usr/local/bin/docker-compose
ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
docker-compose --version



Check which service use port 80:

1.netstat -lntp | grep 80

How i kill service running in port 80:

2.sudo kill $(sudo netstat -anp | awk '/ LISTEN / {if($4 ~ ":80$") { gsub("/.*","",$7); print $7; exit } }')



###########################################################################


Serve static files using docker nginx:

Install Nginx:
docker pull nginx

Then:
 docker run -d -p 8000:80 -v /Users/admin/Desktop/aws:/usr/share/nginx/html --name my-nginx nginx


#############################################################################
Create a Reverse Proxy inside the docker container
Install Nginx:
docker pull nginx

Run the Nginx:
docker run -d -p 80:80 nginx

Go inside the Container:
docker exec -it containerid bash

Commands:
1.cd /etc/nginx/conf.d
2.delete the default.conf
3.create two folders: sites-available and sites-enabled.
4.go to the sites-enabled and create a reverse proxy file
5.go to the file nginx.conf and change include /etc/nginx/conf.d/*.conf; to include /etc/nginx/conf.d/sites-enabled/*.conf;
6.nginx -s reload




#############################################################################
Block Iframe

1.open the reverse proxy file for e.g vim /etc/nginx/sites-enabled/myfile
2.add these line add_header X-Frame-Options "DENY";


#############################################################################


Larvel deployment:

https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-laravel-with-nginx-on-ubuntu-20-04

Step1:
Install php or update your older php version:
 https://devanswers.co/how-to-upgrade-from-php-7-x-to-php-8-on-ubuntu-apache/

1.To uninstall PHP 7.x and all of its extensions, run the command below. Press y and ENTER when prompted.
    sudo apt-get purge php7.*

2.After uninstalling packages from Linux, it’s advised to run these two commands.
    sudo apt-get autoclean
    sudo apt-get autoremove

3.Install PHP 8.
   sudo add-apt-repository ppa:ondrej/php
   sudo apt-get update
   sudo apt-get install php8.0

   
4.Install PHP 8 Extensions:
    sudo apt install php-mbstring php-xml php-bcmath
    sudo apt-get install php8.0-pdo-mysql
    sudo apt install php-fpm

5.Install php Composer:
  sudo apt install composer


6.Install composer dependencies:
 composer install --prefer-dist


7.Run these commands to create the tables within the defined database and populate seed data:
 php artisan migrate --seed
  
8.storage permission:
 chmod -R gu+w storage
 chmod -R guo+w storage
 php artisan cache:clear




9.Setting Up Nginx: 
 it’s not a recommended practice for web servers that are open to the public internet. We’ll move the application folder to /var/www, which is the usual location for web applications running on Nginx.


 sudo mv ~/yourproject /var/www/directoryname


 Now we need to give the web server user write access to the storage and cache folders, where Laravel stores application-generated files:

 sudo chown -R www-data.www-data /var/www/travellist/storage
 sudo chown -R www-data.www-data /var/www/travellist/bootstrap/cache


server {


    listen 80;
    server_name localhost;
    root /home/shakeeb/Desktop/LARVEL/Plating/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    index index.html index.htm index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}



service nginx restart



###################################################### Introduction to kubernetes. #####################################################



Kubernetes:

kubernetes is a container  orchestration solution.orchestration means jb ak bar apki image create hogaye for e.g docker ka through tu ap usko high available kasa banaye ga,ya loadbalancing aur auto scaling kasa karaga.

kubernetes is a master slave architecture.kubernetes ka sab sa bara advantage ya ha isko use kar ka ap easily apni application ko roleup aur roleback kar sakta ha for e.g apki application ka new version 2.0 realease hoa aur usma koi issue agaya tu hum easily roleback kar ka 1.0 version pa asakta ha.

Features of kubernetes:
1.Automatic Binpacking:
    jb bi hum apni application ko deploy karta ha container ki form ma tu wo container automatically 
    correct resource ko khud  allocate karla.


2.loadbalancing:
 means jb apki application pa zada load ana ki waja sa apki ak node band hojae tu traffic dosra node pa shift hojae.


3.storage orchestration:
 kubernetes hum different types of storage solution use kar sakta ha.


4.Self Healing:
  Iska simple matlab kubernetes ma ya Feature ha ka wo  apna dedicated resource ko excess kara aur agar koi node down hojae tu uski jagha dosri node ko available karwaye.


5.Secrete and Configuration managment:
  kubernetes ma buildin machanism hota ha Secrete store karna ka liya agr ap koi external tool use nhi karna chahta tu iska build in Feature use kar sakta ha apni keys ko encrpt karna ka liya.ya apki keys ko base64 ma convert karta ha.

6.Batch Execution:
  jb bi hum kubernetes run karta ha tu job background ma run karti ha ishi tarha sa hum multiple jobs ko background ma run kar sakta ha.means sequential batch managment.

7.Horizontal Scaling:
  kubernetes world ma fundamental unit ko pods bolta ha .kubernetes ma containers khud sa involved nhi karta  containers humesha pods ka andar consine hota ha . kubernetes ka architecture ma hum apna pods ko Horizontal scale kar sakta ha . Horizontal scaling ka matlab ya ha ka hum new pord apni requirements ka according create kar sakta ha.


8.Automatic Rollbacks and roleout:

  kubernetes ka sab sa bara advantage ya ha isko use kar ka ap easily apni application ko roleup aur roleback kar sakta ha for e.g apki application ka new version 2.0 realease hoa aur usma koi issue agaya tu hum easily roleback kar ka 1.0 version pa asakta ha.



Few Myths About kubernetes:
  1.Docker is container solution and kubernetes is a orchestration solution.  
  2.Docker ko use kar ka hum images ko create karta ha aur images hi container ma convert hota ha. kubernetes ko use kar ka hum images ko create nhi kar sakta.



Kubernetes vs Docker swarm:
1.Both are container orchestration solution.
2.Dono ma fark ya ha ka agar apna apni appplication ko docker ki help sa containerize kiya tu hi ap docker swarm use kar sakta ho.jb ka ap kubernetes kisi bi container platform ka liya use kar sakta ho.

3.Docker swarm itna zada scalable nhi ha kubernetes ka moqabala ma.
4.Docker swarm ma built in loadbalancing technique hoti ha . jb ka kubernetes ma apko enable karni parhti ha.

5.Docker swarm ki update itni zada clean nhi ha.
6.Docker swarm ma container volume ko ap container sa dosra container ma share nhi kar sakta.jb ka kubernetes ma ap isko achieve kar sakta ho.

7.kubernetes ma inbuilt logging and monitoring tool ha jb ka docker swarm ma apko 3rd party tool use karna parha ga.



What is master?
Master controls the cluster and the nodes init.

What is node?
 nodes host the containers inside them. containers are inside separate pods


What is PODS?
  pods are logical collection of containers which need to interact with each other for an application


############################################ Cloudfront ###############################################################################################

Cloudfront:
Cloudfront is just a cdn(Content delivery network) service for aws.cdn means asi service jiski edge service all over the world ha edge location means datacenter.

################################################Push image to docker Hub################################################################################


docker tag firstimage YOUR_DOCKERHUB_NAME/firstimage
docker push YOUR_DOCKERHUB_NAME/firstimage






















